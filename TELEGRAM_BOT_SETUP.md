# Telegram Bot ãƒ†ã‚¹ãƒˆç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰

## ğŸ“‹ ç›®æ¬¡
1. [å‰ææ¡ä»¶](#å‰ææ¡ä»¶)
2. [Telegram Botä½œæˆ](#telegram-botä½œæˆ)
3. [é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](#é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—)
4. [ãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆãƒˆãƒ³ãƒãƒ«è¨­å®š](#ãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆãƒˆãƒ³ãƒãƒ«è¨­å®š)
5. [Telegram Botå®Ÿè£…](#telegram-botå®Ÿè£…)
6. [ãƒ†ã‚¹ãƒˆæ‰‹é †](#ãƒ†ã‚¹ãƒˆæ‰‹é †)
7. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)

---

## å‰ææ¡ä»¶

### å¿…è¦ãªã‚‚ã®
- âœ… Telegram ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
- âœ… Python 3.10ä»¥ä¸Š
- âœ… ç¾åœ¨ã®Djangoãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
- âœ… ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶š

### ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶
- Windows 10/11 ã¾ãŸã¯ macOS/Linux
- æœ€ä½2GB RAM
- 500MBä»¥ä¸Šã®ãƒ‡ã‚£ã‚¹ã‚¯ç©ºãå®¹é‡

---

## Telegram Botä½œæˆ

### ã‚¹ãƒ†ãƒƒãƒ—1: BotFatherã§Botä½œæˆ

1. **Telegramã‚¢ãƒ—ãƒªã‚’é–‹ã**

2. **BotFatherã‚’æ¤œç´¢**
   - æ¤œç´¢æ¬„ã« `@BotFather` ã¨å…¥åŠ›
   - å…¬å¼ã®é’ã„ãƒã‚§ãƒƒã‚¯ãƒãƒ¼ã‚¯ä»˜ãã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’é¸æŠ

3. **æ–°ã—ã„Botã‚’ä½œæˆ**
   ```
   /newbot
   ```

4. **Botåã‚’å…¥åŠ›**ï¼ˆä¾‹ï¼‰
   ```
   Mobile Order System
   ```

5. **Botã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›**ï¼ˆãƒ¦ãƒ‹ãƒ¼ã‚¯ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼‰
   ```
   your_restaurant_order_bot
   ```
   â€» åå‰ã¯ `bot` ã§çµ‚ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™

6. **Bot Tokenã‚’ä¿å­˜**
   - BotFatherã‹ã‚‰å—ã‘å–ã£ãŸãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚³ãƒ”ãƒ¼
   - å½¢å¼: `1234567890:ABCdefGHIjklMNOpqrsTUVwxyz`
   - âš ï¸ **ã“ã®ãƒˆãƒ¼ã‚¯ãƒ³ã¯çµ¶å¯¾ã«å…¬é–‹ã—ãªã„ã“ã¨ï¼**

### ã‚¹ãƒ†ãƒƒãƒ—2: Botè¨­å®š

1. **Mini Appsã‚’æœ‰åŠ¹åŒ–**
   ```
   /setmenubutton
   ```
   - ä½œæˆã—ãŸBotã‚’é¸æŠ
   - `Edit Menu Button` ã‚’é¸æŠ
   - ãƒœã‚¿ãƒ³å: `æ³¨æ–‡ã™ã‚‹`
   - URL: `https://your-domain.com/` ï¼ˆå¾Œã§å¤‰æ›´ï¼‰

2. **Botã®èª¬æ˜ã‚’è¨­å®š**
   ```
   /setdescription
   ```
   - Botã‚’é¸æŠ
   - èª¬æ˜ã‚’å…¥åŠ›:
   ```
   é£²é£Ÿåº—ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚ªãƒ¼ãƒ€ãƒ¼ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚
   QRã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã¦ã€ç°¡å˜ã«æ³¨æ–‡ã§ãã¾ã™ã€‚
   ```

3. **Botã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒã‚’è¨­å®š**ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
   ```
   /setuserpic
   ```

### ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ†ã‚¹ãƒˆã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆ

1. **æ–°è¦ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆ**
   - ã‚°ãƒ«ãƒ¼ãƒ—å: `æ³¨æ–‡ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ`
   
2. **Botã‚’ã‚°ãƒ«ãƒ¼ãƒ—ã«è¿½åŠ **
   - ä½œæˆã—ãŸBotã‚’æ¤œç´¢ã—ã¦è¿½åŠ 

3. **Botã‚’ç®¡ç†è€…ã«è¨­å®š**ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
   - ã‚°ãƒ«ãƒ¼ãƒ—è¨­å®š â†’ ç®¡ç†è€… â†’ Botã‚’è¿½åŠ 

---

## é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### ã‚¹ãƒ†ãƒƒãƒ—1: å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
cd C:\Users\user\gh\TelBotOrderDjango

# ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install python-telegram-bot==20.7
pip install qrcode==7.4.2
pip install pillow==10.1.0
pip install python-dotenv==1.0.0
```

### ã‚¹ãƒ†ãƒƒãƒ—2: requirements.txtã‚’æ›´æ–°

```bash
# ç¾åœ¨ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
pip freeze > requirements.txt
```

### ã‚¹ãƒ†ãƒƒãƒ—3: ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã« `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆï¼š

```bash
# .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
New-Item -Path .env -ItemType File
```

`.env` ã®å†…å®¹:
```env
# Djangoè¨­å®š
SECRET_KEY=your-secret-key-here
DEBUG=True
ALLOWED_HOSTS=localhost,127.0.0.1,*.ngrok-free.app

# Telegram Botè¨­å®š
TELEGRAM_BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz
TELEGRAM_BOT_USERNAME=your_restaurant_order_bot

# Webhook URLï¼ˆngrokèµ·å‹•å¾Œã«æ›´æ–°ï¼‰
TELEGRAM_WEBHOOK_URL=https://your-ngrok-url.ngrok-free.app

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
DATABASE_URL=sqlite:///db.sqlite3

# ãã®ä»–
TIME_ZONE=Asia/Tokyo
LANGUAGE_CODE=ja
```

### ã‚¹ãƒ†ãƒƒãƒ—4: .gitignoreã«è¿½åŠ 

`.gitignore` ã«ä»¥ä¸‹ã‚’è¿½åŠ ï¼ˆæ—¢ã«å«ã¾ã‚Œã¦ã„ãªã„å ´åˆï¼‰:
```
.env
*.log
db.sqlite3
__pycache__/
*.pyc
media/
staticfiles/
```

---

## ãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆãƒˆãƒ³ãƒãƒ«è¨­å®š

Telegram Webhookã¯ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãªhttps URLãŒå¿…è¦ãªãŸã‚ã€ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã«ã¯ãƒˆãƒ³ãƒãƒ«ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³1: ngrokï¼ˆæ¨å¥¨ï¼‰

#### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

1. **ngrokã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**
   - https://ngrok.com/download
   - Windowsç‰ˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

2. **ngrokã‚’é…ç½®**
   ```bash
   # ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸngrok.exeã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã«é…ç½®
   # ã¾ãŸã¯ã€PATHã«è¿½åŠ 
   ```

3. **ngrokã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ**ï¼ˆç„¡æ–™ï¼‰
   - https://dashboard.ngrok.com/signup
   - ç™»éŒ²å¾Œã€Authtokenã‚’å–å¾—

4. **Authtokenã‚’è¨­å®š**
   ```bash
   ngrok config add-authtoken YOUR_AUTHTOKEN
   ```

#### ä½¿ç”¨æ–¹æ³•

```bash
# Djangoã‚µãƒ¼ãƒãƒ¼ç”¨ãƒˆãƒ³ãƒãƒ«ã‚’èµ·å‹•
ngrok http 8000
```

å‡ºåŠ›ä¾‹:
```
Session Status                online
Account                       your-email@example.com
Forwarding                    https://abc123.ngrok-free.app -> http://localhost:8000
```

âš ï¸ **ã“ã® `https://abc123.ngrok-free.app` URLã‚’ `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã® `TELEGRAM_WEBHOOK_URL` ã«è¨­å®š**

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³2: localtunnel

```bash
# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install -g localtunnel

# ä½¿ç”¨
lt --port 8000 --subdomain your-order-system
```

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³3: Cloudflare Tunnelï¼ˆç„¡æ–™ã€æ°¸ç¶šçš„URLï¼‰

```bash
# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
# https://developers.cloudflare.com/cloudflare-one/connections/connect-apps/install-and-setup/

# ä½¿ç”¨
cloudflared tunnel --url http://localhost:8000
```

---

## Telegram Botå®Ÿè£…

### ã‚¹ãƒ†ãƒƒãƒ—1: Botã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆ

```bash
# æ–°ã—ã„Djangoã‚¢ãƒ—ãƒªã‚’ä½œæˆ
python manage.py startapp telegram_bot
```

### ã‚¹ãƒ†ãƒƒãƒ—2: settings.pyã‚’æ›´æ–°

`mobile_order_system/settings.py` ã«è¿½åŠ :

```python
import os
from dotenv import load_dotenv

# .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿
load_dotenv()

# INSTALLED_APPSã«è¿½åŠ 
INSTALLED_APPS = [
    # ... æ—¢å­˜ã®ã‚¢ãƒ—ãƒª
    'telegram_bot',
]

# Telegram Botè¨­å®š
TELEGRAM_BOT_TOKEN = os.getenv('TELEGRAM_BOT_TOKEN')
TELEGRAM_BOT_USERNAME = os.getenv('TELEGRAM_BOT_USERNAME')
TELEGRAM_WEBHOOK_URL = os.getenv('TELEGRAM_WEBHOOK_URL')

# ALLOWED_HOSTSã‚’æ›´æ–°
ALLOWED_HOSTS = os.getenv('ALLOWED_HOSTS', 'localhost,127.0.0.1').split(',')
```

### ã‚¹ãƒ†ãƒƒãƒ—3: URLãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®š

`mobile_order_system/urls.py` ã«è¿½åŠ :

```python
from django.urls import path, include

urlpatterns = [
    # ... æ—¢å­˜ã®URL
    path('telegram/', include('telegram_bot.urls')),
]
```

### ã‚¹ãƒ†ãƒƒãƒ—4: Telegram Botå®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ

ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ï¼š

1. **telegram_bot/bot.py** - Botæœ¬ä½“
2. **telegram_bot/handlers.py** - ã‚³ãƒãƒ³ãƒ‰ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
3. **telegram_bot/views.py** - Webhookå—ä¿¡
4. **telegram_bot/urls.py** - URLãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
5. **telegram_bot/utils.py** - ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°

è©³ç´°ãªå®Ÿè£…ã¯æ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§æä¾›ã—ã¾ã™ã€‚

---

## ãƒ†ã‚¹ãƒˆæ‰‹é †

### ãƒ†ã‚¹ãƒˆç’°å¢ƒã®èµ·å‹•

#### ã‚¿ãƒ¼ãƒŸãƒŠãƒ«1: Djangoã‚µãƒ¼ãƒãƒ¼èµ·å‹•

```bash
cd C:\Users\user\gh\TelBotOrderDjango
python manage.py runserver 0.0.0.0:8000
```

#### ã‚¿ãƒ¼ãƒŸãƒŠãƒ«2: ngrokãƒˆãƒ³ãƒãƒ«èµ·å‹•

```bash
ngrok http 8000
```

ngrokãŒè¡¨ç¤ºã™ã‚‹HTTPS URLã‚’ã‚³ãƒ”ãƒ¼ï¼ˆä¾‹: `https://abc123.ngrok-free.app`ï¼‰

#### ã‚¿ãƒ¼ãƒŸãƒŠãƒ«3: Webhookè¨­å®š

```bash
# .envãƒ•ã‚¡ã‚¤ãƒ«ã®TELEGRAM_WEBHOOK_URLã‚’æ›´æ–°ã—ã¦ã‹ã‚‰å®Ÿè¡Œ
python manage.py set_telegram_webhook
```

ã¾ãŸã¯ã€curlã§ç›´æ¥è¨­å®š:
```bash
curl -X POST "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/setWebhook" \
  -d "url=https://abc123.ngrok-free.app/telegram/webhook/"
```

### ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª

#### 1. Botèµ·å‹•ãƒ†ã‚¹ãƒˆ

1. Telegramã§è‡ªåˆ†ã®Botã‚’æ¤œç´¢
2. `/start` ã‚³ãƒãƒ³ãƒ‰ã‚’é€ä¿¡
3. ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¿”ã£ã¦ãã‚‹ã“ã¨ã‚’ç¢ºèª

#### 2. QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆãƒ†ã‚¹ãƒˆ

1. ç®¡ç†ç”»é¢ã§ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆ
2. QRã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
3. QRã‚³ãƒ¼ãƒ‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

#### 3. ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹ãƒ†ã‚¹ãƒˆ

1. Botã®ãƒãƒ£ãƒƒãƒˆã§QRã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³ï¼ˆã¾ãŸã¯ `/start table-A-1` ã‚³ãƒãƒ³ãƒ‰ï¼‰
2. äººæ•°é¸æŠç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
3. äººæ•°ã‚’é¸æŠ
4. ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

#### 4. æ³¨æ–‡ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆ

1. ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠ
2. ãƒ¡ãƒ‹ãƒ¥ãƒ¼é …ç›®ã‚’é¸æŠ
3. æ•°é‡ã‚’é¸æŠ
4. ã‚«ãƒ¼ãƒˆã«è¿½åŠ 
5. æ³¨æ–‡ç¢ºå®š
6. æ³¨æ–‡ç•ªå·ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

#### 5. ç®¡ç†ç”»é¢ç¢ºèªãƒ†ã‚¹ãƒˆ

1. Django Adminã«ãƒ­ã‚°ã‚¤ãƒ³
2. æ³¨æ–‡ç®¡ç†ç”»é¢ã‚’é–‹ã
3. æ–°è¦æ³¨æ–‡ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
4. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ã€Œèª¿ç†ä¸­ã€ã«æ›´æ–°
5. Telegram Botã«é€šçŸ¥ãŒå±Šãã“ã¨ã‚’ç¢ºèª

#### 6. åº—å“¡å‘¼ã³å‡ºã—ãƒ†ã‚¹ãƒˆ

1. Botç”»é¢ã§ã€Œåº—å“¡ã‚’å‘¼ã¶ã€ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—
2. ç†ç”±ã‚’é¸æŠ
3. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
4. é€ä¿¡
5. ç®¡ç†ç”»é¢ã§å‘¼ã³å‡ºã—ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

#### 7. ä¼šè¨ˆãƒ†ã‚¹ãƒˆ

1. Botç”»é¢ã§ã€Œä¼šè¨ˆã€ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—
2. åˆè¨ˆé‡‘é¡ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
3. ä¼šè¨ˆä¾é ¼ãŒé€ä¿¡ã•ã‚Œã‚‹
4. ç®¡ç†ç”»é¢ã§ä¼šè¨ˆä¾é ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
5. ç®¡ç†ç”»é¢ã§ä¼šè¨ˆå®Œäº†å‡¦ç†
6. Botã«å®Œäº†é€šçŸ¥ãŒå±Šãã“ã¨ã‚’ç¢ºèª

### ãƒ­ã‚°ç¢ºèª

```bash
# Djangoã‚µãƒ¼ãƒãƒ¼ã®ãƒ­ã‚°
# ã‚¿ãƒ¼ãƒŸãƒŠãƒ«1ã§ç¢ºèª

# ngrokã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ­ã‚°
# http://127.0.0.1:4040 ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã
```

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### å•é¡Œ1: WebhookãŒè¨­å®šã§ããªã„

**ç—‡çŠ¶**: `setWebhook` ãŒå¤±æ•—ã™ã‚‹

**è§£æ±ºç­–**:
```bash
# ç¾åœ¨ã®Webhookæƒ…å ±ã‚’ç¢ºèª
curl https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getWebhookInfo

# Webhookã‚’å‰Šé™¤
curl https://api.telegram.org/bot<YOUR_BOT_TOKEN>/deleteWebhook

# å†è¨­å®š
curl -X POST "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/setWebhook" \
  -d "url=https://your-ngrok-url.ngrok-free.app/telegram/webhook/"
```

### å•é¡Œ2: BotãŒå¿œç­”ã—ãªã„

**ç¢ºèªäº‹é …**:
1. âœ… ngrokãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹
2. âœ… Djangoã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹
3. âœ… `.env` ã®Bot TokenãŒæ­£ã—ã„ã‹
4. âœ… Webhook URLãŒæ­£ã—ã„ã‹
5. âœ… ngrokã®ãƒ­ã‚°ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå±Šã„ã¦ã„ã‚‹ã‹ (`http://127.0.0.1:4040`)

**ãƒ‡ãƒãƒƒã‚°æ–¹æ³•**:
```bash
# Webhookæƒ…å ±ã‚’ç¢ºèª
python manage.py shell

from telegram_bot.bot import bot
print(bot.get_webhook_info())
```

### å•é¡Œ3: HTTPSè¨¼æ˜æ›¸ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: SSL/TLSé–¢é€£ã®ã‚¨ãƒ©ãƒ¼

**è§£æ±ºç­–**:
```python
# settings.py ã«è¿½åŠ 
SECURE_SSL_REDIRECT = False  # é–‹ç™ºç’°å¢ƒã®ã¿
```

### å•é¡Œ4: ngrokã®URLãŒå¤‰ã‚ã‚‹

**ç—‡çŠ¶**: ngrokå†èµ·å‹•ã®ãŸã³ã«URLãŒå¤‰ã‚ã‚Šã€Webhookå†è¨­å®šãŒå¿…è¦

**è§£æ±ºç­–**:
1. ngrokã®æœ‰æ–™ãƒ—ãƒ©ãƒ³ï¼ˆæœˆ$8ï¼‰ã§å›ºå®šã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ä½¿ç”¨
2. ã¾ãŸã¯ã€Cloudflare Tunnelã‚’ä½¿ç”¨ï¼ˆç„¡æ–™ã§æ°¸ç¶šçš„URLï¼‰

**Cloudflare Tunnelè¨­å®š**:
```bash
# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
# https://developers.cloudflare.com/cloudflare-one/connections/connect-apps/install-and-setup/

# ãƒˆãƒ³ãƒãƒ«ä½œæˆ
cloudflared tunnel create order-system

# ãƒˆãƒ³ãƒãƒ«èµ·å‹•
cloudflared tunnel --url http://localhost:8000
```

### å•é¡Œ5: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: IntegrityError ã‚„ DoesNotExist ã‚¨ãƒ©ãƒ¼

**è§£æ±ºç­–**:
```bash
# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å†å®Ÿè¡Œ
python manage.py migrate

# ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿å†ä½œæˆ
python manage.py create_test_data

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒªã‚»ãƒƒãƒˆï¼ˆæ³¨æ„: å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ï¼‰
rm db.sqlite3
python manage.py migrate
python manage.py create_test_data
```

### å•é¡Œ6: ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¡¨ç¤ºã•ã‚Œãªã„

**ç—‡çŠ¶**: ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»åƒã‚„QRã‚³ãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œãªã„

**è§£æ±ºç­–**:
```python
# settings.py ã‚’ç¢ºèª
MEDIA_URL = '/media/'
MEDIA_ROOT = BASE_DIR / 'media'
```

```python
# urls.py ã«è¿½åŠ ï¼ˆé–‹ç™ºç’°å¢ƒã®ã¿ï¼‰
from django.conf import settings
from django.conf.urls.static import static

if settings.DEBUG:
    urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
```

### å•é¡Œ7: Telegram APIãƒ¬ãƒ¼ãƒˆåˆ¶é™

**ç—‡çŠ¶**: `429 Too Many Requests` ã‚¨ãƒ©ãƒ¼

**è§£æ±ºç­–**:
```python
# bot.py ã§ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚’å®Ÿè£…
import time
from functools import wraps

def rate_limit(seconds=1):
    def decorator(func):
        last_called = [0.0]
        @wraps(func)
        def wrapper(*args, **kwargs):
            elapsed = time.time() - last_called[0]
            if elapsed < seconds:
                time.sleep(seconds - elapsed)
            result = func(*args, **kwargs)
            last_called[0] = time.time()
            return result
        return wrapper
    return decorator
```

---

## ãƒ†ã‚¹ãƒˆç”¨ã‚³ãƒãƒ³ãƒ‰ä¸€è¦§

### Telegram Botç®¡ç†ã‚³ãƒãƒ³ãƒ‰

```bash
# Webhookè¨­å®š
python manage.py set_telegram_webhook

# Webhookå‰Šé™¤
python manage.py delete_telegram_webhook

# Webhookæƒ…å ±ç¢ºèª
python manage.py check_telegram_webhook

# QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆï¼ˆå…¨ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰
python manage.py generate_qr_codes

# Botæƒ…å ±ç¢ºèª
python manage.py shell
>>> from telegram_bot.bot import bot
>>> print(bot.get_me())
```

### APIãƒ†ã‚¹ãƒˆï¼ˆcurlï¼‰

```bash
# ãƒ¡ãƒ‹ãƒ¥ãƒ¼å–å¾—
curl http://localhost:8000/api/menu-items/

# ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ
curl -X POST http://localhost:8000/api/sessions/ \
  -H "Content-Type: application/json" \
  -d '{"qr_code_url":"https://t.me/yourbot?start=table-A-1","party_size":4}'

# æ³¨æ–‡ä½œæˆ
curl -X POST http://localhost:8000/api/orders/ \
  -H "Content-Type: application/json" \
  -d '{"session_code":"TBL1-20241128-ABC123","telegram_user_id":"123","items":[{"menu_item_id":1,"quantity":2}]}'
```

### é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

`start_dev.bat` (Windows) ã¾ãŸã¯ `start_dev.sh` (Mac/Linux) ã‚’ä½œæˆ:

```bash
@echo off
echo Starting Mobile Order System...
echo.

echo [1/3] Starting Django Server...
start cmd /k "cd C:\Users\user\gh\TelBotOrderDjango && python manage.py runserver 0.0.0.0:8000"

timeout /t 3

echo [2/3] Starting ngrok tunnel...
start cmd /k "ngrok http 8000"

echo.
echo [3/3] Setup complete!
echo.
echo Next steps:
echo 1. Copy the ngrok HTTPS URL from the ngrok window
echo 2. Update .env file with the new TELEGRAM_WEBHOOK_URL
echo 3. Run: python manage.py set_telegram_webhook
echo.
pause
```

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

é–‹ç™ºç’°å¢ƒã§ã‚‚ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

- [ ] `.env` ãƒ•ã‚¡ã‚¤ãƒ«ãŒ `.gitignore` ã«å«ã¾ã‚Œã¦ã„ã‚‹
- [ ] Bot TokenãŒã‚³ãƒ¼ãƒ‰ã«ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ãªã„
- [ ] `DEBUG=False` ã‚’æœ¬ç•ªç’°å¢ƒã§è¨­å®š
- [ ] `ALLOWED_HOSTS` ãŒé©åˆ‡ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚»ã‚­ãƒ¥ã‚¢ãªSECRET_KEYã‚’ä½¿ç”¨
- [ ] Webhook URLãŒHTTPSã§ã‚ã‚‹
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½“åˆ¶ãŒã‚ã‚‹

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. **åŸºæœ¬å®Ÿè£…**: æ¬¡ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ `TELEGRAM_BOT_IMPLEMENTATION.md` ã‚’å‚ç…§
2. **Mini Apps UI**: Telegram Mini Appsç”¨ã®React/Vue.jsãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…
3. **æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤**: Heroku/AWS/GCPã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤
4. **ç›£è¦–è¨­å®š**: Sentry, New Relicãªã©ã®ã‚¨ãƒ©ãƒ¼ç›£è¦–

---

**ä½œæˆæ—¥**: 2024-11-28  
**å¯¾è±¡**: ãƒ†ã‚¹ãƒˆç’°å¢ƒ  
**å‰æ**: Django REST APIãŒå®Ÿè£…æ¸ˆã¿
